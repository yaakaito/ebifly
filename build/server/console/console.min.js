var EBI={message:{type:{none:99,log:0,exception:1,script:2,result:3,requestHTML:4,sendHTML:5},origin:{unkown:99,client:0,server:1,console:2},last:0},html:{type:{none:99,textNode:0,tag:1}},createMessageObject:function(){return{id:this.message.last++,type:this.message.type.none,msg:"",origin:this.message.type.unkown,time:this.createTimeString(new Date)}},createTimeString:function(a){var c=a.getHours(),b=a.getMinutes(),d=a.getSeconds(),a=a.getMilliseconds();c<10&&(c="0"+c);b<10&&(b="0"+b);d<10&&(d="0"+
d);a<10&&(a="0"+a);a<100&&(a="0"+a);return c+":"+b+":"+d+"."+a},getChildren:function(a){for(var c=[],b=0,d=a.childNodes.length;b<d;b++)a.childNodes[b].nodeType==1&&c.push(a.childNodes[b]);return c}},ebiconsole={event:{},socket:null,message:{last:0},last:0,htmlModelObj:null,registeredHTML:!1};
ebiconsole.connect=function(a){this.socket=new io.Socket(a.host||"localhost",{port:a.port||8080,rememberTransport:!1});this.socket.connect();this.socket.on("connect",function(){});this.socket.on("message",function(a){ebiconsole.event.message(a)});this.socket.on("disconnect",function(){});$("runscript").addEventListener("click",function(){ebiconsole.runScript()});$("clearlogs").addEventListener("click",function(){ebiconsole.clearLog()});$("script").addEventListener("keyup",function(a){a.keyCode===
13&&$("checkReturnScript").checked&&ebiconsole.runScript()});this.socket.send(this.message.createRequestHTML());a=document.querySelector("article#html > section > details");document.querySelector("article#html > section > details > summary").addEventListener("click",function(a){return function(){a.getAttribute("open")?a.removeAttribute("open"):a.setAttribute("open","open")}}(a),!1)};ebiconsole.updateHTMLTag=function(){};
ebiconsole.selectNode=function(a){var a=a.split(","),c=1,b=a.length,d=this.htmlModelObj,j;if(b==1)return this.htmlModelObj;for(;c<b;c++)if(j=a[c],d.children.length>j)d=d.children[j];else return null;return d};
ebiconsole.event.message=function(a){a.mt=ebiconsole.message.createTimeString(new Date);ebiconsole.message.last=+a.last;a.type==EBI.message.type.log?ebiconsole.insertLog(a):a.type==EBI.message.type.result?ebiconsole.insertLog(a):a.type==EBI.message.type.exception?ebiconsole.insertLog(a):a.type==EBI.message.type.sendHTML&&ebiconsole.updateHTML(a)};ebiconsole.event.clickHTMLDetails=function(){};ebiconsole.message.createLog=function(a){var c=this.createBase();c.type="LOG";c.msg=a;return c};
ebiconsole.message.createRequestHTML=function(){var a=this.createBase();a.type="RHT";return a};ebiconsole.message.createBase=function(){return{id:this.last++,type:null,org:"c",msg:"base message",mt:this.createTimeString(new Date),st:null,ct:null}};ebiconsole.message.createTimeString=function(a){var c=a.getHours(),b=a.getMinutes(),d=a.getSeconds(),a=a.getMilliseconds();c<10&&(c="0"+c);b<10&&(b="0"+b);d<10&&(d="0"+d);a<10&&(a="0"+a);a<100&&(a="0"+a);return c+":"+b+":"+d+"."+a};var $=function(a){return document.getElementById(a)};
(function(){ebiconsole.connect({host:"localhost",port:8080})})();ebiconsole.updateHTML=function(a){this.registeredHTML?this.remakeHTML(a.msg,this.htmlModelObj,document.querySelector("article#html > section > details")):(this.registerHTML(a.msg,document.querySelector("article#html > section > details")),this.registeredHTML=!0);this.htmlModelObj=a.msg};
ebiconsole.registerHTML=function(a,c){for(var b=0,d=a.children,j=d.length;b<j;b++){var f=document.createElement("details"),e=document.createElement("summary");if(d[b].type==EBI.html.type.tag){for(var k="&lt;"+d[b].tag,g=d[b].attributes,h=0,l=g.length;h<l;h++)k+=" <span class='name'>"+g[h].name+"</span>=<span class='value'>\""+g[h].value+'"</span>';e.innerHTML=k+">";f.setAttribute("tag","tag");f.setAttribute("ebifly",d[b].id);f.appendChild(e);c.appendChild(f);e.addEventListener("click",function(a){return function(){a.getAttribute("open")?
a.removeAttribute("open"):a.setAttribute("open","open")}}(f));d[b].children.length>0?this.registerHTML(d[b],f):f.setAttribute("last","last")}else f=document.createElement("details"),e=document.createElement("summary"),e.innerHTML="<span class='textnode'>"+d[b].value+"</span>",f.appendChild(e),c.appendChild(f)}};
ebiconsole.remakeHTML=function(a,c,b){var d=0,j=a.children,f=j.length,c=c.children,d=c.length;console.log(b);console.log(b.childNodes.length);if(f!=d)b.innerHTML="",this.registerHTML(a,b);else for(d=0;d<f;d++){var e=j[d],k=c[d],g=!1;if(e.id!=k.id){b.innerHTML="";this.registerHTML(a,b);break}else{if(e.attributes.length!=k.attributes.length)g=!0;else for(var h=e.attributes,l=k.attributes,i=0;i<h.length;i++)if(h[i].name!==l[i].name){g=!0;break}else if(h[i].value!==l[i].value){g=!0;break}e.value!==k.value&&
(g=!0);h=EBI.getChildren(b)[d+1];l=h.childNodes[0];if(g)if(e.type==EBI.html.type.tag){for(var g="&lt;"+e.tag,m=e.attributes,i=0,n=m.length;i<n;i++)g+=" <span class='name'>"+m[i].name+"</span>=<span class='value'>\""+m[i].value+'"</span>';l.innerHTML=g+">";e.children.length>0||h.setAttribute("last","last")}else l.innerHTML="<span class='textnode'>"+e.value+"</span>";e.children.length>0&&this.remakeHTML(e,k,h)}}};
ebiconsole.toggleHTMLTag=function(a){a.getAttribute("open")?a.setAttribute("open","open"):a.removeAttribute("open")};
ebiconsole.insertLog=function(a){var c=$("message");a.type==EBI.message.type.log?c.innerHTML+="["+a.time+"] "+a.msg+"\n":a.type==EBI.message.type.script?c.innerHTML+="<span class='script'>>>"+a.msg+"</span>\n":a.type==EBI.message.type.result?c.innerHTML+="<span class='result'>>>"+a.msg+"</span>\n":a.type==EBI.message.type.exception&&(c.innerHTML+="<span class='exception'>>>"+a.msg+"</span>\n");c.scrollTop=1E8};ebiconsole.clearLog=function(){$("message").innerHTML=""};
ebiconsole.runScript=function(){var a=function(a){var b=EBI.createMessageObject();b.type=EBI.message.type.script;b.msg=a;b.origin=EBI.message.origin.console;return b}($("script").value.replace(/^(.*?)\n*$/,"$1"));this.socket.send(a);this.insertLog(a);if($("checkClearScript").checked)$("script").value=""};
