var ebi={message:{type:{none:99,log:0,exception:1,script:2,result:3,requestHTML:4,sendHTML:5},origin:{unkown:99,client:0,server:1,console:2},last:0},createMessageObject:function(){return{id:this.message.last++,type:this.message.type.none,msg:"",origin:this.message.type.unkown,time:this.createTimeString(new Date)}},createTimeString:function(a){var b=a.getHours(),c=a.getMinutes(),d=a.getSeconds(),a=a.getMilliseconds();b<10&&(b="0"+b);c<10&&(c="0"+c);d<10&&(d="0"+d);a<10&&(a="0"+a);a<100&&(a="0"+a);
return b+":"+c+":"+d+"."+a}},ebifly={event:{},socket:null,message:{last:0},last:0};ebifly.connect=function(a){this.socket=new io.Socket(a.host||"localhost",{port:a.port||8080,rememberTransport:!1});this.socket.connect();this.socket.on("connect",function(){});this.socket.on("message",function(a){ebifly.event.message(a)});this.socket.on("disconnect",function(){})};
ebifly.sendHTML=function(){var a=this.message.createHTML(this.message.elementToJSON(document.querySelector("html")));if(arguments.length==1&&arguments[0]==!0)a.broadcast=!0;this.socket.send(a)};ebifly.event.message=function(a){a.ct=ebifly.message.createTimeString(new Date);ebifly.message.last=+a.last;a.type==ebi.message.type.script?ebifly.executeScript(a):a.type=="RHT"&&ebifly.sendHTML(!0)};ebifly.message.createHTML=function(a){var b=this.createBase();b.type="HTM";b.msg=a;return b};
ebifly.message.createBase=function(){return{id:this.last++,type:null,org:"c",msg:"base message",mt:null,st:null,ct:this.createTimeString(new Date)}};ebifly.message.createTimeString=function(a){var b=a.getHours(),c=a.getMinutes(),d=a.getSeconds(),a=a.getMilliseconds();b<10&&(b="0"+b);c<10&&(c="0"+c);d<10&&(d="0"+d);a<10&&(a="0"+a);a<100&&(a="0"+a);return b+":"+c+":"+d+"."+a};
ebifly.message.elementToJSON=function(a){if(a.tagName==null||a.tagName===void 0)return console.log(a.innerHTML),{tag:"TextNode",value:a.nodeValue,str:"TextNode"+a.innerHTML};var b={tag:a.tagName.toLowerCase(),attributes:[],children:[],str:a.tagName.toLowerCase()},c=0,d=0,e;b.str+=a.attributes.length;for(e=a.attributes.length;c<e;c++)b.attributes.push({name:a.attributes[c].name,value:a.attributes[c].value}),b.str=b.str+a.attributes[c].name+a.attributes[c].value;for(e=a.childNodes.length;d<e;d++)b.children.push(this.elementToJSON(a.childNodes[d]));
b.str+=e;return b};(function(){attachEbiIds=function(a,b){if(a.tagName===null||a.tagName===void 0)return b;a.setAttribute("ebifly",b++);for(var c=0,d=a.childNodes.length;c<d;c++)b=attachEbiIds(a.childNodes[c],b);return b};attachEbiIds(document.querySelector("html"),0)})();ebifly.log=function(a){this.socket.send(this.createLog(ebi.message.type.log,a))};ebifly.exception=function(a){this.socket.send(this.createLog(ebi.message.type.exception,a))};
ebifly.result=function(a){this.socket.send(this.createLog(ebi.message.type.result,a))};ebifly.createLog=function(a,b){var c=ebi.createMessageObject();c.type=a;c.msg=b;c.origin=ebi.message.origin.client;return c};ebifly.executeScript=function(a){if(a.type==ebi.message.type.script)try{ebifly.result(eval(a.msg))}catch(b){ebifly.exception(b.message)}};(function(){ebifly.connect({host:"localhost",port:8080})})();
