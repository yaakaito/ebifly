var ebifly={event:{},socket:null,message:{last:0},last:0};ebifly.connect=function(a){this.socket=new io.Socket(a.host||"localhost",{port:a.port||8080,rememberTransport:!1});this.socket.connect();this.socket.on("connect",function(){});this.socket.on("message",function(a){ebifly.event.message(a)});this.socket.on("disconnect",function(){});setInterval(function(){ebifly.sendHTML()},100)};ebifly.log=function(a){this.socket.send(ebifly.message.createLog(a))};ebifly.exception=function(a){this.socket.send(ebifly.message.createException(a))};
ebifly.result=function(a){this.socket.send(ebifly.message.createResult(a))};ebifly.sendHTML=function(){var a=this.message.createHTML(this.message.elementToJSON(document.querySelector("html")));if(arguments.length==1&&arguments[0]==!0)a.broadcast=!0;this.socket.send(a)};ebifly.event.message=function(a){a.ct=ebifly.message.createTimeString(new Date);ebifly.message.last=+a.last;a.type=="SCR"?ebifly.executeScript(a):a.type=="RHT"&&ebifly.sendHTML(!0)};ebifly.executeScript=function(a){try{ebifly.result(eval(a.msg))}catch(b){ebifly.exception(b.message)}};
ebifly.message.createLog=function(a){var b=this.createBase();b.type="LOG";b.msg=a;return b};ebifly.message.createException=function(a){var b=this.createBase();b.type="EXP";b.msg=a;return b};ebifly.message.createHTML=function(a){var b=this.createBase();b.type="HTM";b.msg=a;return b};ebifly.message.createResult=function(a){var b=this.createBase();b.type="RES";b.msg=a;return b};ebifly.message.createBase=function(){return{id:this.last++,type:null,org:"c",msg:"base message",mt:null,st:null,ct:this.createTimeString(new Date)}};
ebifly.message.createTimeString=function(a){var b=a.getHours(),c=a.getMinutes(),d=a.getSeconds(),a=a.getMilliseconds();b<10&&(b="0"+b);c<10&&(c="0"+c);d<10&&(d="0"+d);a<10&&(a="0"+a);a<100&&(a="0"+a);return b+":"+c+":"+d+"."+a};
ebifly.message.elementToJSON=function(a){if(a.tagName==null||a.tagName===void 0)return console.log(a.innerHTML),{tag:"TextNode",value:a.nodeValue,str:"TextNode"+a.innerHTML};var b={tag:a.tagName.toLowerCase(),attributes:[],children:[],str:a.tagName.toLowerCase()},c=0,d=0,e;b.str+=a.attributes.length;for(e=a.attributes.length;c<e;c++)b.attributes.push({name:a.attributes[c].name,value:a.attributes[c].value}),b.str=b.str+a.attributes[c].name+a.attributes[c].value;for(e=a.childNodes.length;d<e;d++)b.children.push(this.elementToJSON(a.childNodes[d]));
b.str+=e;return b};(function(){ebifly.connect({host:"localhost",port:8080})})();
